# Test-bot
## Как запустить проект локально (Docker):

1. Клонируйте репозиторий:
   ```
   git clone https://github.com/Birobizhan/test-bot.git
   cd test-bot
   ```

2. Настройте переменные окружения:
   Создайте файл .env в корневой папке и заполните его по примеру файла .env.example:
   ```
	BOT_TOKEN=your_telegram_bot_token  
	OPENAI_API_KEY=your_openrouter_api_key  
	DB_USER=postgres  
	DB_PASSWORD=your_password  
	DB_NAME=your_name_db  
	DB_PORT=5432
   ```

3. Запустите проект через docker compose:
   ```
   docker compose up -d --build
   ```

## Архитектура и подход:
1. Пользователь запускает бота через команду /start
2. Пользователь пишет вопрос (например: Самое большое количество просмотров на видео за все время)
3. Вопрос отправляется в модель с подготовленным системным промптом
4. Модель, зная схему БД, генерирует чистый SQL-запрос
5. Бот выполняет запрос в PostgreSQL
6. Результат (число) отправляется пользователю

### Системный промпт:
Для работы приложения был использован промпт, который:
- Описывает структуру таблиц (videos и video_snapshots)
- Предотвращает SQL-инъекции с помощью ограничения только на select запросы
- Устанавливает правила логики (например, использование SUM(delta_...) для расчета прироста).
- Запрещает модели возвращать лишний текст или пояснения (только чистый SQL)
- Устанавливает temperature=0 для обеспечения стабильности результатов

## Стек:
- Язык: Python 3.11+
- Фреймворк: Aiogram
- База данных: PostgreSQL + Asyncpg
- LLM: Trinity Large Preview (через OpenRouter API)
- Развертывание: Docker Compose